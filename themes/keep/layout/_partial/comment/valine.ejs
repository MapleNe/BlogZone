<% if(
        theme.comment.use === 'valine'
        && theme.comment.valine.appid
        && theme.comment.valine.appkey
) { %>
    <div class="valine-container">
        <script <%= theme.pjax.enable === true ? 'data-pjax' : '' %>
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script <%= theme.pjax.enable === true ? 'data-pjax' : '' %>>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: '<%= theme.comment.valine.appid %>',
                    appKey: '<%= theme.comment.valine.appkey %>',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '<%= theme.comment.valine.placeholder %>',
                    lang: '<%= config.language %>'.toLowerCase(),
					// 设置Bilibili表情包地址
					emojiCDN: '//cdn.jsdelivr.net/gh/GamerNoTitle/ValineCDN@master/', 
					// 表情title和图片映射
					emojiMaps: {
								"bilibilitv2": "bilibilitv/[tv_doge].png",
								"bilibilitv3": "bilibilitv/[tv_亲亲].png",
								"bilibilitv4": "bilibilitv/[tv_偷笑].png",
								"bilibilitv5": "bilibilitv/[tv_再见].png",
								"bilibilitv6": "bilibilitv/[tv_冷漠].png",
								"bilibilitv7": "bilibilitv/[tv_发怒].png",
								"bilibilitv8": "bilibilitv/[tv_发财].png",
								"bilibilitv9": "bilibilitv/[tv_可爱].png",
								"bilibilitv10": "bilibilitv/[tv_吐血].png",
								"bilibilitv11": "bilibilitv/[tv_呆].png",
								"bilibilitv12": "bilibilitv/[tv_呕吐].png",
								"bilibilitv13": "bilibilitv/[tv_困].png",
								"bilibilitv14": "bilibilitv/[tv_坏笑].png",
								"bilibilitv15": "bilibilitv/[tv_大佬].png",
								"bilibilitv16": "bilibilitv/[tv_大哭].png",
								"bilibilitv17": "bilibilitv/[tv_委屈].png",
								"bilibilitv18": "bilibilitv/[tv_害羞].png",
								"bilibilitv19": "bilibilitv/[tv_尴尬].png",
								"bilibilitv20": "bilibilitv/[tv_微笑].png",
								"bilibilitv21": "bilibilitv/[tv_思考].png",
								"bilibilitv22": "bilibilitv/[tv_惊吓].png",
								"bilibilitv23": "bilibilitv/[tv_打脸].png",
								"bilibilitv24": "bilibilitv/[tv_抓狂].png",
								"bilibilitv25": "bilibilitv/[tv_抠鼻].png",
								"bilibilitv26": "bilibilitv/[tv_斜眼笑].png",
								"bilibilitv27": "bilibilitv/[tv_无奈].png",
								"bilibilitv28": "bilibilitv/[tv_晕].png",
								"bilibilitv29": "bilibilitv/[tv_流汗].png",
								"bilibilitv30": "bilibilitv/[tv_流泪].png",
								"bilibilitv31": "bilibilitv/[tv_流鼻血].png",
								"bilibilitv32": "bilibilitv/[tv_点赞].png",
								"bilibilitv33": "bilibilitv/[tv_生气].png",
								"bilibilitv34": "bilibilitv/[tv_生病].png",
								"bilibilitv35": "bilibilitv/[tv_疑问].png",
								"bilibilitv36": "bilibilitv/[tv_白眼].png",
								"bilibilitv37": "bilibilitv/[tv_皱眉].png",
								"bilibilitv38": "bilibilitv/[tv_目瞪口呆].png",
								"bilibilitv39": "bilibilitv/[tv_睡着].png",
								"bilibilitv40": "bilibilitv/[tv_笑哭].png",
								"bilibilitv41": "bilibilitv/[tv_腼腆].png",
								"bilibilitv42": "bilibilitv/[tv_色].png",
								"bilibilitv43": "bilibilitv/[tv_调侃].png",
								"bilibilitv44": "bilibilitv/[tv_调皮].png",
								"bilibilitv45": "bilibilitv/[tv_鄙视].png",
								"bilibilitv46": "bilibilitv/[tv_闭嘴].png",
								"bilibilitv47": "bilibilitv/[tv_难过].png",
								"bilibilitv48": "bilibilitv/[tv_馋].png",
								"bilibilitv49": "bilibilitv/[tv_鬼脸].png",
								"bilibilitv50": "bilibilitv/[tv_黑人问号].png",
								"bilibilitv51": "bilibilitv/[tv_鼓掌].png"
								"Coolapk2": "Coolapk/coolapk_emotion_100_qqdoge.png",
								"Coolapk3": "Coolapk/coolapk_emotion_1010.png",
								"Coolapk4": "Coolapk/coolapk_emotion_1011.png",
								"Coolapk5": "Coolapk/coolapk_emotion_1012.png",
								"Coolapk6": "Coolapk/coolapk_emotion_1013.png",
								"Coolapk7": "Coolapk/coolapk_emotion_1014.png",
								"Coolapk8": "Coolapk/coolapk_emotion_1015.png",
								"Coolapk9": "Coolapk/coolapk_emotion_1016.png",
								"Coolapk10": "Coolapk/coolapk_emotion_1017.png",
								"Coolapk11": "Coolapk/coolapk_emotion_1018.png",
								"Coolapk12": "Coolapk/coolapk_emotion_1019.png",
								"Coolapk13": "Coolapk/coolapk_emotion_101_pyjiaoyi.png",
								"Coolapk14": "Coolapk/coolapk_emotion_1020.png",
								"Coolapk15": "Coolapk/coolapk_emotion_1021.png",
								"Coolapk16": "Coolapk/coolapk_emotion_102_fadai.png",
								"Coolapk17": "Coolapk/coolapk_emotion_103_nb.png",
								"Coolapk18": "Coolapk/coolapk_emotion_104.png",
								"Coolapk19": "Coolapk/coolapk_emotion_105.png",
								"Coolapk20": "Coolapk/coolapk_emotion_106.png",
								"Coolapk21": "Coolapk/coolapk_emotion_107.png",
								"Coolapk22": "Coolapk/coolapk_emotion_108.png",
								"Coolapk23": "Coolapk/coolapk_emotion_109.png",
								"Coolapk24": "Coolapk/coolapk_emotion_10_aoman.png",
								"Coolapk25": "Coolapk/coolapk_emotion_11_yiwen.png",
								"Coolapk26": "Coolapk/coolapk_emotion_12_wuyu.png",
								"Coolapk27": "Coolapk/coolapk_emotion_13_huaixiao.png",
								"Coolapk28": "Coolapk/coolapk_emotion_14_bishi.png",
								"Coolapk29": "Coolapk/coolapk_emotion_15_fanu.png",
								"Coolapk30": "Coolapk/coolapk_emotion_16_tuosai.png",
								"Coolapk31": "Coolapk/coolapk_emotion_17_tushe.png",
								"Coolapk32": "Coolapk/coolapk_emotion_18_han.png",
								"Coolapk33": "Coolapk/coolapk_emotion_19_koubi.png",
								"Coolapk34": "Coolapk/coolapk_emotion_1_hahaha.png",
								"Coolapk35": "Coolapk/coolapk_emotion_20_qinqin.png",
								"Coolapk36": "Coolapk/coolapk_emotion_21_penxue.png",
								"Coolapk37": "Coolapk/coolapk_emotion_22_xiaoyan.png",
								"Coolapk38": "Coolapk/coolapk_emotion_23_shui.png",
								"Coolapk39": "Coolapk/coolapk_emotion_24_wuzuixiao.png",
								"Coolapk40": "Coolapk/coolapk_emotion_25_zaijian.png",
								"Coolapk41": "Coolapk/coolapk_emotion_26_kelian.png",
								"Coolapk42": "Coolapk/coolapk_emotion_27_qiang.png",
								"Coolapk43": "Coolapk/coolapk_emotion_28_ruo.png",
								"Coolapk44": "Coolapk/coolapk_emotion_29_baoquan.png",
								"Coolapk45": "Coolapk/coolapk_emotion_2_jingya.png",
								"Coolapk46": "Coolapk/coolapk_emotion_30_ok.png",
								"Coolapk47": "Coolapk/coolapk_emotion_31_xiaoku.png",
								"Coolapk48": "Coolapk/coolapk_emotion_32_heiha.png",
								"Coolapk49": "Coolapk/coolapk_emotion_33_wulian.png",
								"Coolapk50": "Coolapk/coolapk_emotion_34_jizhi.png",
								"Coolapk51": "Coolapk/coolapk_emotion_35_ye.png",
								"Coolapk52": "Coolapk/coolapk_emotion_36_ku.png",
								"Coolapk53": "Coolapk/coolapk_emotion_37_doge.png",
								"Coolapk54": "Coolapk/coolapk_emotion_38_wozuimei.png",
								"Coolapk55": "Coolapk/coolapk_emotion_39_caidao.png",
								"Coolapk56": "Coolapk/coolapk_emotion_3_ciya.png",
								"Coolapk57": "Coolapk/coolapk_emotion_40_aixin.png",
								"Coolapk58": "Coolapk/coolapk_emotion_41_meigui.png",
								"Coolapk59": "Coolapk/coolapk_emotion_42_diaoxie.png",
								"Coolapk60": "Coolapk/coolapk_emotion_43_heixian.png",
								"Coolapk61": "Coolapk/coolapk_emotion_44_pen.png",
								"Coolapk62": "Coolapk/coolapk_emotion_45_yinxian.png",
								"Coolapk63": "Coolapk/coolapk_emotion_46_nanguo.png",
								"Coolapk64": "Coolapk/coolapk_emotion_47_weiqu.png",
								"Coolapk65": "Coolapk/coolapk_emotion_48_weiweiyixiao.png",
								"Coolapk66": "Coolapk/coolapk_emotion_49_huanhu.png",
								"Coolapk67": "Coolapk/coolapk_emotion_4_liulei.png",
								"Coolapk68": "Coolapk/coolapk_emotion_50_xinsui.png",
								"Coolapk69": "Coolapk/coolapk_emotion_51_chigua.png",
								"Coolapk70": "Coolapk/coolapk_emotion_52_hejiu.png",
								"Coolapk71": "Coolapk/coolapk_emotion_53_pu.png",
								"Coolapk72": "Coolapk/coolapk_emotion_54_hongyaowan.png",
								"Coolapk73": "Coolapk/coolapk_emotion_55_lvyaowan.png",
								"Coolapk74": "Coolapk/coolapk_emotion_56_dogexiaoku.png",
								"Coolapk75": "Coolapk/coolapk_emotion_57_dogehechi.png",
								"Coolapk76": "Coolapk/coolapk_emotion_58_dogeyuanliangta.png",
								"Coolapk77": "Coolapk/coolapk_emotion_59_erha.png",
								"Coolapk78": "Coolapk/coolapk_emotion_5_keai.png",
								"Coolapk79": "Coolapk/coolapk_emotion_60_kuan.png",
								"Coolapk80": "Coolapk/coolapk_emotion_61_lvmao.png",
								"Coolapk81": "Coolapk/coolapk_emotion_62_huaji.png",
								"Coolapk82": "Coolapk/coolapk_emotion_63_liuhanhuaji.png",
								"Coolapk83": "Coolapk/coolapk_emotion_64_shounuehuaji.png",
								"Coolapk84": "Coolapk/coolapk_emotion_65_coshuaji.png",
								"Coolapk85": "Coolapk/coolapk_emotion_66_doujiyanhuaji.png",
								"Coolapk86": "Coolapk/coolapk_emotion_67_mojinghuaji.png",
								"Coolapk87": "Coolapk/coolapk_emotion_68.png",
								"Coolapk88": "Coolapk/coolapk_emotion_69.png",
								"Coolapk89": "Coolapk/coolapk_emotion_6_weixiao.png",
								"Coolapk90": "Coolapk/coolapk_emotion_70.png",
								"Coolapk91": "Coolapk/coolapk_emotion_71.png",
								"Coolapk92": "Coolapk/coolapk_emotion_72.png",
								"Coolapk93": "Coolapk/coolapk_emotion_73.png",
								"Coolapk94": "Coolapk/coolapk_emotion_74.png",
								"Coolapk95": "Coolapk/coolapk_emotion_75.png",
								"Coolapk96": "Coolapk/coolapk_emotion_76.png",
								"Coolapk97": "Coolapk/coolapk_emotion_77.png",
								"Coolapk98": "Coolapk/coolapk_emotion_78.png",
								"Coolapk99": "Coolapk/coolapk_emotion_79.png",
								"Coolapk100": "Coolapk/coolapk_emotion_7_hehe.png",
								"Coolapk101": "Coolapk/coolapk_emotion_80.png",
								"Coolapk102": "Coolapk/coolapk_emotion_81_naikezui.png",
								"Coolapk103": "Coolapk/coolapk_emotion_82_miaomiao.png",
								"Coolapk104": "Coolapk/coolapk_emotion_83_huoba.png",
								"Coolapk105": "Coolapk/coolapk_emotion_84_baiyan.png",
								"Coolapk106": "Coolapk/coolapk_emotion_85.png",
								"Coolapk107": "Coolapk/coolapk_emotion_86.png",
								"Coolapk108": "Coolapk/coolapk_emotion_87.png",
								"Coolapk109": "Coolapk/coolapk_emotion_88.png",
								"Coolapk110": "Coolapk/coolapk_emotion_89.png",
								"Coolapk111": "Coolapk/coolapk_emotion_8_piezui.png",
								"Coolapk112": "Coolapk/coolapk_emotion_90.png",
								"Coolapk113": "Coolapk/coolapk_emotion_91.png",
								"Coolapk114": "Coolapk/coolapk_emotion_92.png",
								"Coolapk115": "Coolapk/coolapk_emotion_93.png",
								"Coolapk116": "Coolapk/coolapk_emotion_94.png",
								"Coolapk117": "Coolapk/coolapk_emotion_95_erhading.png",
								"Coolapk118": "Coolapk/coolapk_emotion_96_kuanlvmao.png",
								"Coolapk119": "Coolapk/coolapk_emotion_97_haixiu.png",
								"Coolapk120": "Coolapk/coolapk_emotion_98_wunai.png",
								"Coolapk121": "Coolapk/coolapk_emotion_99_zhoumei.png",
								"Coolapk122": "Coolapk/coolapk_emotion_9_se.png",
								"Coolapk123": "Coolapk/c_coolb.png",
								"Coolapk124": "Coolapk/c_fived.png",
								"Coolapk125": "Coolapk/c_fivef.png",
								"Coolapk126": "Coolapk/c_fivem.png",
								"Coolapk127": "Coolapk/c_fiveo.png",
								"Coolapk128": "Coolapk/c_fivey.png",
								"Coolapk129": "Coolapk/c_fy.png",
								"Coolapk130": "Coolapk/c_oned.png",
								"Coolapk131": "Coolapk/c_onef.png",
								"Coolapk132": "Coolapk/c_onem.png",
								"Coolapk133": "Coolapk/c_oneo.png",
								"Coolapk134": "Coolapk/c_oney.png",
								"Coolapk135": "Coolapk/c_oy.png",
								"Coolapk136": "Coolapk/c_teny.png",
								"Coolapk137": "Coolapk/c_twod.png",
								"Coolapk138": "Coolapk/c_twof.png",
								"Coolapk139": "Coolapk/c_twom.png",
								"Coolapk140": "Coolapk/c_twoo.png",
								"Coolapk141": "Coolapk/c_twoy.png",
								"Coolapk142": "Coolapk/c_ty.png",
								}
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = '<%= theme.base_info.author || config.author %>';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('<%= theme.pjax.enable %>') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>
<% } %>
